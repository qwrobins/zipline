# Story 2.3: User Profile - Posts Tab

## Status
Approved

## Story
**As a** user,
**I want** to see all posts written by a specific user on their profile,
**so that** I can explore an author's content in one place.

## Acceptance Criteria
1. Tabbed interface on user profile with "Posts" as first tab (using shadcn/ui Tabs)
2. Posts tab displays all posts by that user in a list format
3. Each post item shows: title, body excerpt, and link to full post detail
4. Post count displayed in tab label (e.g., "Posts (10)")
5. Empty state message if user has no posts
6. Loading skeleton shown while posts are being fetched
7. Posts are clickable and navigate to post detail page
8. API efficiently fetches only posts for this user (`/users/{id}/posts` or filtered)

## Tasks / Subtasks
- [ ] Install shadcn Tabs component (AC: 1)
  - [ ] Run `pnpm dlx shadcn@latest add tabs`
  - [ ] Verify Tabs component is available
- [ ] Update UserProfile component with Tabs (AC: 1)
  - [ ] Wrap profile content sections in Tabs component
  - [ ] Create "Posts" tab as first tab
  - [ ] Create "Overview" tab for existing profile sections
  - [ ] Add proper tab styling and transitions
- [ ] Implement API service for user posts (AC: 8)
  - [ ] Add `fetchUserPosts(userId: number)` to `lib/api/posts.ts`
  - [ ] Use query parameter or endpoint: `/posts?userId={id}`
  - [ ] Validate response with existing postArraySchema
- [ ] Create React Query hook for user posts (AC: 6, 8)
  - [ ] Add `useUserPosts(userId: number)` to `lib/hooks/use-posts.ts`
  - [ ] Configure proper query key with userId parameter
  - [ ] Implement loading and error states
  - [ ] Add staleTime and cacheTime configuration
- [ ] Create UserPostsList component (AC: 2, 3, 7)
  - [ ] Create `components/users/user-posts-list.tsx`
  - [ ] Display posts in list format (not grid)
  - [ ] Show title as heading for each post
  - [ ] Show body excerpt (truncated to 150-200 chars)
  - [ ] Add "Read more" link to post detail
  - [ ] Use Card component for each post item
- [ ] Implement post count in tab label (AC: 4)
  - [ ] Calculate post count from useUserPosts data
  - [ ] Display count in tab label: "Posts ({count})"
  - [ ] Show loading state in tab label while fetching
  - [ ] Update count reactively when data changes
- [ ] Create loading state for posts tab (AC: 6)
  - [ ] Use Skeleton components in posts list
  - [ ] Display 3-5 skeleton post items
  - [ ] Match layout of actual post items
  - [ ] Show skeleton in tab while loading
- [ ] Create empty state for posts (AC: 5)
  - [ ] Add conditional rendering for empty posts array
  - [ ] Display message: "This user hasn't written any posts yet"
  - [ ] Add icon or illustration for empty state
  - [ ] Center empty state within tab content
- [ ] Implement post navigation (AC: 7)
  - [ ] Use Next.js Link component for post items
  - [ ] Navigate to `/posts/{id}` on click
  - [ ] Add hover states to post items
  - [ ] Ensure entire card is clickable
- [ ] Integrate posts tab with user profile page (AC: 1)
  - [ ] Update `/app/users/[id]/page.tsx` to include Tabs
  - [ ] Pass userId to UserPostsList component
  - [ ] Ensure proper data fetching on tab mount
  - [ ] Test tab switching and navigation

## Dev Notes

### Route Structure
[Source: docs/architecture/unified-project-structure.md]

Modify existing file:
```
app/
‚îú‚îÄ‚îÄ users/
‚îÇ   ‚îî‚îÄ‚îÄ [id]/
‚îÇ       ‚îî‚îÄ‚îÄ page.tsx       # Update to include Tabs component
```

### Data Models
[Source: docs/architecture/data-models.md]

Use the Post interface:
```typescript
interface Post {
  id: number;
  userId: number;
  title: string;
  body: string;
}
```

The Post has a many-to-one relationship with User through the userId foreign key.

### API Service Implementation
[Source: docs/architecture/components.md, docs/architecture/frontend-architecture.md]

Add to `lib/api/posts.ts`:
```typescript
import { apiFetch } from './client';
import { postArraySchema } from './schemas';
import type { Post } from '@/types';

export async function fetchUserPosts(userId: number): Promise<Post[]> {
  return apiFetch(`/posts?userId=${userId}`, undefined, postArraySchema);
}
```

Note: The JSONPlaceholder API supports filtering posts by userId using query parameters.

### React Query Hook
[Source: docs/architecture/components.md, docs/architecture/frontend-architecture.md]

Add to `lib/hooks/use-posts.ts`:
```typescript
import { useQuery } from '@tanstack/react-query';
import { fetchUserPosts } from '@/lib/api/posts';
import { queryKeys } from '@/lib/query-keys';

export function useUserPosts(userId: number) {
  return useQuery({
    queryKey: queryKeys.posts.list({ userId }),
    queryFn: () => fetchUserPosts(userId),
    staleTime: 5 * 60 * 1000, // 5 minutes
    cacheTime: 10 * 60 * 1000, // 10 minutes
  });
}
```

Update `lib/query-keys.ts` to support userId filter:
```typescript
export const queryKeys = {
  posts: {
    all: ['posts'] as const,
    lists: () => [...queryKeys.posts.all, 'list'] as const,
    list: (filters: { userId?: number; page?: number } = {}) =>
      [...queryKeys.posts.lists(), filters] as const,
    details: () => [...queryKeys.posts.all, 'detail'] as const,
    detail: (id: number) => [...queryKeys.posts.details(), id] as const,
  },
} as const;
```

### Component Structure
[Source: docs/architecture/components.md]

Components to create:
- `components/users/user-posts-list.tsx` - List of user's posts
- Update `components/users/user-profile.tsx` to include Tabs

### shadcn/ui Tabs Component
[Source: docs/architecture/tech-stack.md]

Install Tabs component:
```bash
pnpm dlx shadcn@latest add tabs
```

Basic Tabs usage:
```typescript
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';

<Tabs defaultValue="posts">
  <TabsList>
    <TabsTrigger value="posts">Posts ({postCount})</TabsTrigger>
    <TabsTrigger value="overview">Overview</TabsTrigger>
  </TabsList>
  <TabsContent value="posts">
    <UserPostsList userId={userId} />
  </TabsContent>
  <TabsContent value="overview">
    {/* Existing profile sections */}
  </TabsContent>
</Tabs>
```

### Post Count Implementation
Display count reactively in tab label:
```typescript
const { data: posts, isLoading } = useUserPosts(userId);
const postCount = posts?.length ?? 0;

<TabsTrigger value="posts">
  Posts {isLoading ? '(...)' : `(${postCount})`}
</TabsTrigger>
```

### Post Excerpt Truncation
Implement body text truncation:
```typescript
function truncateText(text: string, maxLength: number): string {
  if (text.length <= maxLength) return text;
  return text.slice(0, maxLength).trim() + '...';
}

// Usage
<p className="text-slate-600 text-sm">
  {truncateText(post.body, 150)}
</p>
```

Or use Tailwind CSS line-clamp utility:
```typescript
<p className="text-slate-600 text-sm line-clamp-3">
  {post.body}
</p>
```

### Post Item Layout
[Source: docs/architecture/components.md]

Create a clean list layout for posts:
```typescript
import Link from 'next/link';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';

<Link href={`/posts/${post.id}`}>
  <Card className="hover:shadow-md transition-shadow cursor-pointer">
    <CardHeader>
      <CardTitle className="text-lg">{post.title}</CardTitle>
    </CardHeader>
    <CardContent>
      <p className="text-slate-600 text-sm line-clamp-3">
        {post.body}
      </p>
      <div className="mt-4 text-blue-600 text-sm font-medium">
        Read more ‚Üí
      </div>
    </CardContent>
  </Card>
</Link>
```

### Empty State Implementation
[Source: docs/architecture/coding-standards.md]

Display user-friendly empty state:
```typescript
if (posts?.length === 0) {
  return (
    <div className="text-center py-12">
      <div className="text-slate-400 text-4xl mb-4">üìù</div>
      <h3 className="text-lg font-semibold mb-2">No posts yet</h3>
      <p className="text-slate-600">
        This user hasn't written any posts yet.
      </p>
    </div>
  );
}
```

### Loading Skeleton for Posts
[Source: docs/architecture/coding-standards.md]

Use Skeleton components:
```typescript
import { Skeleton } from '@/components/ui/skeleton';

function PostsLoadingSkeleton() {
  return (
    <div className="space-y-4">
      {[1, 2, 3, 4].map((i) => (
        <Card key={i}>
          <CardHeader>
            <Skeleton className="h-6 w-3/4" />
          </CardHeader>
          <CardContent>
            <Skeleton className="h-4 w-full mb-2" />
            <Skeleton className="h-4 w-full mb-2" />
            <Skeleton className="h-4 w-2/3" />
          </CardContent>
        </Card>
      ))}
    </div>
  );
}
```

### Tab Integration with User Profile
Update the user profile page to include tabs:
```typescript
<div className="mb-6">
  {/* Breadcrumb and header */}
</div>

<Tabs defaultValue="posts" className="w-full">
  <TabsList className="mb-6">
    <TabsTrigger value="posts">
      Posts {isLoadingPosts ? '(...)' : `(${posts?.length ?? 0})`}
    </TabsTrigger>
    <TabsTrigger value="overview">Overview</TabsTrigger>
  </TabsList>

  <TabsContent value="posts">
    <UserPostsList userId={userId} />
  </TabsContent>

  <TabsContent value="overview">
    {/* Contact, Company, Address sections */}
  </TabsContent>
</Tabs>
```

### Coding Standards
[Source: docs/architecture/coding-standards.md]

- File naming: kebab-case (e.g., `user-posts-list.tsx`)
- Component naming: PascalCase (e.g., `UserPostsList`)
- Props interfaces: PascalCase with 'Props' suffix
- Use TypeScript strict mode - no `any` types
- Validate API responses with Zod schemas
- Always show skeletons during data fetching
- Display empty states when no data available

### Accessibility Requirements
[Source: docs/architecture/coding-standards.md, docs/architecture/tech-stack.md]

- Tabs component from shadcn/ui has built-in keyboard navigation
- Ensure post cards are keyboard navigable (using Link component)
- Add proper ARIA labels to tab triggers
- Use semantic HTML (article tags for post items)
- Ensure focus states are visible on interactive elements
- Announce tab changes to screen readers

### Testing
[Source: docs/architecture/testing-strategy.md]

Unit tests to create:
- `tests/unit/components/users/user-posts-list.test.tsx` - Test rendering posts, empty state, loading
- `tests/unit/hooks/use-posts.test.ts` - Test user posts query hook

E2E tests to create:
- `tests/e2e/users/view-user-profile.spec.ts` - Update to test Posts tab functionality

Test requirements:
- Verify Posts tab displays user's posts
- Test post count in tab label
- Verify loading skeleton appears while fetching
- Test empty state when user has no posts
- Verify clicking post navigates to post detail page
- Test tab switching between Posts and Overview
- Verify posts are filtered by userId
- Test body text truncation/line clamping

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-30 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

## QA Results
_To be filled by QA Agent_