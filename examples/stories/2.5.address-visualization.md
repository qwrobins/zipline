# Story 2.5: Address Visualization Enhancement

## Status
Approved

## Story
**As a** user,
**I want** a visual representation of a user's location,
**so that** I have a sense of their geographic context.

## Acceptance Criteria
1. Static map placeholder replaced with a more polished visual (can use a service like placeholder.com with map styling)
2. Address coordinates (lat/lng) displayed below address text
3. Map placeholder sized appropriately (e.g., 400x200px) and responsive
4. Optional: Use a static map service (Mapbox Static API, Google Static Maps) with no API key required, or an SVG placeholder
5. Fallback handling if map service unavailable
6. Map visual clearly indicates this is non-interactive (no zoom, pan controls)

## Tasks / Subtasks
- [ ] Design map placeholder visual approach (AC: 1, 4)
  - [ ] Research no-API-key static map options (OpenStreetMap static tiles, SVG placeholder)
  - [ ] Choose implementation approach (static map service vs styled placeholder)
  - [ ] Document chosen approach and rationale
- [ ] Implement map placeholder component (AC: 1, 3, 6)
  - [ ] Create MapPlaceholder component
  - [ ] Implement responsive sizing (400x200px on desktop, full width on mobile)
  - [ ] Add visual indicators for non-interactive state (no controls, cursor indication)
  - [ ] Apply proper styling with Tailwind CSS
  - [ ] Ensure accessibility (alt text, ARIA labels)
- [ ] Add coordinates display (AC: 2)
  - [ ] Extract lat/lng from user.address.geo
  - [ ] Format coordinates for display
  - [ ] Position coordinates below address text
  - [ ] Style coordinates appropriately (smaller, muted text)
- [ ] Implement static map integration (if using service) (AC: 4)
  - [ ] Integrate with chosen static map service
  - [ ] Construct URL with lat/lng parameters
  - [ ] Set appropriate zoom level and dimensions
  - [ ] Add markers or pins for user location
  - [ ] Ensure no API key is required or use demo/free tier
- [ ] Implement fallback handling (AC: 5)
  - [ ] Add error boundary or try-catch for image loading
  - [ ] Create fallback visual (colored box with "Map" text or SVG map icon)
  - [ ] Display fallback when map service unavailable
  - [ ] Ensure graceful degradation
- [ ] Update UserProfile component (AC: 1-6)
  - [ ] Replace existing map placeholder with MapPlaceholder component
  - [ ] Pass user address data to component
  - [ ] Verify layout and spacing with new component
- [ ] Test map visualization (AC: 1-6)
  - [ ] Verify map placeholder displays correctly
  - [ ] Verify coordinates display below address
  - [ ] Verify responsive behavior on mobile and desktop
  - [ ] Verify non-interactive state is clear
  - [ ] Verify fallback displays when service unavailable
  - [ ] Test with different user addresses and coordinates

## Dev Notes

### Data Models
[Source: docs/architecture/data-models.md]

**User Address Structure:**
```typescript
interface User {
  // ... other fields
  address: {
    street: string;
    suite: string;
    city: string;
    zipcode: string;
    geo: {
      lat: string;  // Note: API returns string, not number
      lng: string;  // Note: API returns string, not number
    };
  };
  // ... other fields
}
```

**Important:** Coordinates are strings in the API response, may need parsing for numeric operations.

### Component Structure
[Source: docs/architecture/unified-project-structure.md]

**Component Location:**
```
components/
├── users/
│   ├── user-profile.tsx    # Update this to use MapPlaceholder
│   └── map-placeholder.tsx # New component to create
```

### Static Map Service Options

**Option 1: OpenStreetMap Static Tiles (No API Key)**
- URL pattern: `https://tile.openstreetmap.org/{zoom}/{x}/{y}.png`
- Requires lat/lng to tile coordinate conversion
- Free, no API key required
- Must comply with OSM tile usage policy

**Option 2: Placeholder Image Service**
- Example: `https://via.placeholder.com/400x200/cccccc/666666?text=Map`
- Simple colored box with text
- No external dependencies
- Guaranteed availability

**Option 3: SVG Placeholder**
- Create custom SVG with map-like styling
- Embedded directly in component
- No external requests
- Full styling control

**Recommendation:** Start with SVG placeholder or simple image service for reliability, can enhance later.

### Example Static Map URL (if using Mapbox/Google)
```typescript
// Note: These require API keys, consider for optional enhancement only
// Mapbox: https://api.mapbox.com/styles/v1/mapbox/streets-v11/static/{lng},{lat},{zoom}/{width}x{height}?access_token={token}
// Google: https://maps.googleapis.com/maps/api/staticmap?center={lat},{lng}&zoom={zoom}&size={width}x{height}&key={key}
```

### Responsive Sizing
[Source: docs/architecture/tech-stack.md]

**Use Next.js Image Optimization:**
[Source: docs/architecture/tech-stack.md]
- Use `next/image` component for automatic optimization
- PRD requirement (NFR16): WebP conversion and lazy loading
- Example: `<Image src={mapUrl} alt="User location map" width={400} height={200} />`

**Tailwind Responsive Classes:**
```typescript
className="w-full h-48 md:w-[400px] md:h-[200px]"
```

### Styling Guidelines
[Source: docs/architecture/coding-standards.md]

**Non-Interactive Indicator:**
- Consider adding cursor style: `cursor-default` or `cursor-not-allowed`
- Add visual overlay or border indicating non-interactive state
- Consider adding text label: "Static Map" or icon overlay

### Accessibility Requirements
[Source: docs/architecture/coding-standards.md]

**Critical Rule:** All interactive elements must have proper ARIA labels and keyboard navigation

**For this story:**
- Image must have descriptive alt text: e.g., "Map showing location at {city}, {zipcode}"
- Coordinates should be in accessible format
- Consider `aria-label` for map container describing it as decorative/non-interactive

### Error Handling
[Source: docs/architecture/coding-standards.md]

**Critical Rule:** Catch and display user-friendly errors; use toast notifications for feedback

**For Map Loading:**
- Use `onError` handler on image element
- Display fallback visual immediately on error
- No need for toast notification (silent fallback is appropriate)

### Component Example Structure

```typescript
interface MapPlaceholderProps {
  lat: string;
  lng: string;
  city: string;
  zipcode: string;
}

export const MapPlaceholder: FC<MapPlaceholderProps> = ({
  lat,
  lng,
  city,
  zipcode
}) => {
  const [imageError, setImageError] = useState(false);

  // Fallback SVG or styled div
  if (imageError) {
    return <div className="...">Map Unavailable</div>;
  }

  return (
    <div className="relative">
      <Image
        src={mapUrl}
        alt={`Map showing location at ${city}, ${zipcode}`}
        width={400}
        height={200}
        className="w-full h-48 md:w-[400px] md:h-[200px]"
        onError={() => setImageError(true)}
      />
      <div className="absolute bottom-2 right-2 bg-white/80 px-2 py-1 rounded text-xs">
        Static Map
      </div>
    </div>
  );
};
```

### Coordinate Display Formatting

```typescript
// Format coordinates for display
const formatCoordinate = (lat: string, lng: string) => {
  return `${parseFloat(lat).toFixed(4)}°N, ${parseFloat(lng).toFixed(4)}°E`;
  // Or more user-friendly: "Coordinates: 40.7128, -74.0060"
};
```

### File Naming Conventions
[Source: docs/architecture/coding-standards.md]
- Components: PascalCase (e.g., `MapPlaceholder.tsx`)
- Use kebab-case for files (e.g., `map-placeholder.tsx`)

### Testing
[Source: docs/architecture/testing-strategy.md]

**Unit Tests Required:**
- `tests/unit/components/users/map-placeholder.test.tsx`
  - Test rendering with valid coordinates
  - Test fallback behavior on image error
  - Test coordinate formatting
  - Test responsive class application

**Integration Tests Required:**
- Verify MapPlaceholder integrates correctly in UserProfile
- Verify coordinates display correctly from user data
- Verify fallback displays when image fails to load

**E2E Tests Required:**
- Navigate to user profile and verify map placeholder displays
- Verify coordinates are visible below address
- Verify map placeholder is appropriately sized
- Test responsive behavior on different viewport sizes

**Test Coverage Target:** 70%+ component and utility coverage

### Image Optimization
[Source: docs/architecture/tech-stack.md]

**next/image Requirements:**
- Use for automatic image optimization
- Lazy loading enabled by default
- WebP conversion automatic
- Configure `next.config.js` to allow external image domains if using remote map service

```javascript
// next.config.js
module.exports = {
  images: {
    domains: ['tile.openstreetmap.org', 'via.placeholder.com'],
  },
};
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-30 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

## QA Results
_To be filled by QA Agent_