# Story 1.5: Posts Feed - List View with Pagination

## Status
Ready for Review

## Story
**As a** user,
**I want** to see a paginated list of posts from all users,
**so that** I can browse content without being overwhelmed by loading all posts at once.

## Acceptance Criteria
1. Posts feed page (`/` or `/posts`) displays posts in Card components (10 posts per page)
2. Each post card shows: title (truncated if needed), body excerpt (first 100 chars), author avatar and name
3. Loading skeletons displayed while posts are being fetched
4. Empty state message shown if no posts exist
5. Error boundary catches and displays user-friendly error message with retry button
6. Pagination controls displayed at bottom of list (Previous/Next buttons with current page indicator)
7. URL reflects current page via query parameter (`?page=2`)
8. Browser back/forward buttons work correctly with pagination
9. Page parameter persists across navigation and refreshes
10. Post author information fetched efficiently (single users request or joined data)

## Tasks / Subtasks
- [x] Create posts API service functions (AC: 1, 10)
  - [x] Implement `fetchPosts()` in `lib/api/posts.ts` with pagination support
  - [x] Add Zod schema validation for Post array response
  - [x] Create `fetchUsers()` in `lib/api/users.ts` for author data
  - [x] Add Zod schema validation for User array response
- [x] Create React Query hooks for posts (AC: 1, 10)
  - [x] Implement `usePosts()` hook in `lib/hooks/use-posts.ts` with page parameter
  - [x] Implement `useUsers()` hook in `lib/hooks/use-users.ts` for author lookup
  - [x] Configure query keys using centralized queryKeys object
  - [x] Set appropriate staleTime and cacheTime for posts and users
- [x] Build PostCard component (AC: 2)
  - [x] Create `components/posts/post-card.tsx` using shadcn/ui Card
  - [x] Display post title with truncation if needed (CSS line-clamp)
  - [x] Display body excerpt (first 100 characters)
  - [x] Integrate UserAvatar component for author display
  - [x] Display author name next to avatar
  - [x] Add hover effects for better UX
  - [x] Make card clickable to navigate to post detail
- [x] Build PostList component (AC: 1, 2)
  - [x] Create `components/posts/post-list.tsx`
  - [x] Map through posts array and render PostCard for each
  - [x] Add grid or flex layout with responsive columns
  - [x] Pass author data to each PostCard
- [x] Implement loading states (AC: 3)
  - [x] Create `components/shared/loading-skeleton.tsx` for post cards
  - [x] Show 10 skeleton cards while posts are loading
  - [x] Use shadcn/ui Skeleton component for shimmer effect
- [x] Implement empty state (AC: 4)
  - [x] Display friendly message when no posts exist
  - [x] Include illustration or icon for empty state
  - [x] Suggest actions user can take
- [x] Implement error boundary (AC: 5)
  - [x] Create `app/error.tsx` using Next.js error boundary
  - [x] Display user-friendly error message
  - [x] Add retry button that refetches posts
  - [x] Show different messages for network vs API errors
- [x] Build Pagination component (AC: 6, 7, 8, 9)
  - [x] Create `components/shared/pagination.tsx`
  - [x] Add Previous button (disabled on page 1)
  - [x] Add Next button (disabled on last page)
  - [x] Display current page indicator (e.g., "Page 2 of 10")
  - [x] Use URL search params for page state
  - [x] Integrate with Next.js router for navigation
  - [x] Test browser back/forward navigation
- [x] Create posts feed page (AC: 1, 7, 8, 9)
  - [x] Implement `app/page.tsx` or `app/posts/page.tsx`
  - [x] Read page parameter from URL search params
  - [x] Pass page to usePosts hook
  - [x] Render PostList with fetched posts
  - [x] Render Pagination component at bottom
  - [x] Handle URL updates when page changes
  - [x] Verify page state persists on refresh
- [x] Test pagination functionality (AC: 6, 7, 8, 9)
  - [x] Verify clicking Next navigates to next page
  - [x] Verify clicking Previous navigates to previous page
  - [x] Verify URL updates with ?page=N
  - [x] Verify browser back button returns to previous page
  - [x] Verify browser forward button advances to next page
  - [x] Verify page parameter persists on refresh

## Dev Notes

### Data Models
[Source: docs/architecture/data-models.md]

**Post Interface:**
```typescript
interface Post {
  id: number;
  userId: number;
  title: string;
  body: string;
}
```

**User Interface:**
```typescript
interface User {
  id: number;
  name: string;
  username: string;
  email: string;
  address: {
    street: string;
    suite: string;
    city: string;
    zipcode: string;
    geo: {
      lat: string;
      lng: string;
    };
  };
  phone: string;
  website: string;
  company: {
    name: string;
    catchPhrase: string;
    bs: string;
  };
}
```

**Relationships:**
- Post has many-to-one relationship with User (posts.userId → users.id)

### API Service Implementation
[Source: docs/architecture/frontend-architecture.md]

**API Client Setup:**
- Use native Fetch API (no Axios)
- Base URL: `https://jsonplaceholder.typicode.com`
- All responses must be validated with Zod schemas

**Posts Service Example:**
```typescript
// lib/api/posts.ts
import { apiFetch } from './client';
import { postArraySchema } from './schemas';
import type { Post } from '@/types';

export async function fetchPosts(params?: {
  userId?: number;
  page?: number;
}): Promise<Post[]> {
  const searchParams = new URLSearchParams();
  if (params?.userId) searchParams.set('userId', params.userId.toString());

  const query = searchParams.toString();
  const endpoint = `/posts${query ? `?${query}` : ''}`;

  return apiFetch(endpoint, undefined, postArraySchema);
}
```

**Note on Pagination:**
- JSONPlaceholder returns all posts by default (100 posts)
- Implement client-side pagination by slicing array based on page parameter
- Each page shows 10 posts
- Calculate: `posts.slice((page - 1) * 10, page * 10)`

### React Query Configuration
[Source: docs/architecture/frontend-architecture.md]

**Query Keys Structure:**
```typescript
export const queryKeys = {
  posts: {
    all: ['posts'] as const,
    lists: () => [...queryKeys.posts.all, 'list'] as const,
    list: (filters: PostFilters) => [...queryKeys.posts.lists(), filters] as const,
    details: () => [...queryKeys.posts.all, 'detail'] as const,
    detail: (id: number) => [...queryKeys.posts.details(), id] as const,
  },
  users: {
    all: ['users'] as const,
    lists: () => [...queryKeys.users.all, 'list'] as const,
    list: () => [...queryKeys.users.lists()] as const,
    details: () => [...queryKeys.users.all, 'detail'] as const,
    detail: (id: number) => [...queryKeys.users.details(), id] as const,
  },
};
```

**React Query Client Config:**
```typescript
export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 5 * 60 * 1000, // 5 minutes
      cacheTime: 10 * 60 * 1000, // 10 minutes
      retry: 2,
      refetchOnWindowFocus: false,
    },
  },
});
```

**usePosts Hook Pattern:**
```typescript
// lib/hooks/use-posts.ts
export function usePosts(params?: { userId?: number; page?: number }) {
  return useQuery({
    queryKey: queryKeys.posts.list({ userId: params?.userId, page: params?.page }),
    queryFn: () => fetchPosts(params),
  });
}
```

### Component Implementation
[Source: docs/architecture/components.md]

**PostCard Component:**
- Display post title (truncate with CSS if needed)
- Show body excerpt (first 100 characters)
- Include author avatar and name
- Make entire card clickable
- Add hover effects (shadow, scale)

**PostList Component:**
- Render grid/list of PostCard components
- Pass post and author data to each card
- Handle responsive layout

**Pagination Component:**
- Previous/Next buttons using shadcn/ui Button
- Current page indicator
- Disable Previous on page 1
- Disable Next on last page
- Update URL search params on navigation

### URL State Management
[Source: docs/architecture/frontend-architecture.md]

**Route Pattern:**
- Posts feed at `/` or `/posts`
- Page parameter: `?page=2`
- Use Next.js `useSearchParams` hook to read page
- Use Next.js `useRouter` to update URL when page changes

**Implementation:**
```typescript
'use client';
import { useSearchParams, useRouter } from 'next/navigation';

const searchParams = useSearchParams();
const router = useRouter();
const currentPage = parseInt(searchParams.get('page') || '1', 10);

const handlePageChange = (newPage: number) => {
  const params = new URLSearchParams(searchParams);
  params.set('page', newPage.toString());
  router.push(`/?${params.toString()}`);
};
```

### Project Structure
[Source: docs/architecture/unified-project-structure.md]

**Files to Create:**
```
app/
├── page.tsx                        # Posts feed page
├── error.tsx                       # Error boundary
├── loading.tsx                     # Loading UI
components/
├── posts/
│   ├── post-card.tsx              # Individual post card
│   └── post-list.tsx              # List of posts
└── shared/
    ├── pagination.tsx             # Pagination controls
    └── loading-skeleton.tsx       # Loading skeletons
lib/
├── api/
│   ├── client.ts                  # Base API client
│   ├── schemas.ts                 # Zod schemas
│   ├── posts.ts                   # Posts API functions
│   └── users.ts                   # Users API functions
└── hooks/
    ├── use-posts.ts               # Posts query hook
    └── use-users.ts               # Users query hook
```

### Coding Standards
[Source: docs/architecture/coding-standards.md]

**File Naming:**
- Components: PascalCase (`PostCard.tsx`)
- Hooks: camelCase with 'use' prefix (`use-posts.ts`)
- Utilities: camelCase (`format-date.ts`)

**TypeScript:**
- Strict mode enabled
- No `any` types
- All props interfaces defined

**Component Template:**
```typescript
import { FC } from 'react';

interface PostCardProps {
  post: Post;
  onClick?: (id: number) => void;
}

export const PostCard: FC<PostCardProps> = ({ post, onClick }) => {
  // Implementation
};
```

### Accessibility Requirements
[Source: docs/architecture/coding-standards.md]

- All interactive elements must have proper ARIA labels
- Pagination buttons need descriptive labels
- Loading skeletons should have aria-busy="true"
- Error messages should use role="alert"
- Cards need proper semantic HTML (article tags)

### Testing
[Source: docs/architecture/testing-strategy.md]

**Unit Tests Required:**
- `tests/unit/components/posts/post-card.test.tsx` - Test PostCard rendering and click handlers
- `tests/unit/components/posts/post-list.test.tsx` - Test PostList renders multiple cards
- `tests/unit/components/shared/pagination.test.tsx` - Test pagination button states and navigation
- `tests/unit/hooks/use-posts.test.ts` - Test usePosts hook with React Query mock

**Integration Tests Required:**
- `tests/integration/post-viewing.test.tsx` - Test full post feed flow with pagination

**E2E Tests Required:**
- `tests/e2e/posts/view-posts-feed.spec.ts` - Test navigating through pages, URL updates, browser navigation

**Test Pattern:**
```typescript
// tests/unit/components/posts/post-card.test.tsx
import { render, screen } from '@testing-library/react';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { PostCard } from '@/components/posts/post-card';
import type { Post } from '@/types';

const mockPost: Post = {
  id: 1,
  userId: 1,
  title: 'Test Post',
  body: 'This is a test post body',
};

const createWrapper = () => {
  const queryClient = new QueryClient({
    defaultOptions: { queries: { retry: false } },
  });
  return ({ children }: { children: React.ReactNode }) => (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  );
};

describe('PostCard', () => {
  it('renders post title and body excerpt', () => {
    render(<PostCard post={mockPost} />, { wrapper: createWrapper() });

    expect(screen.getByText('Test Post')).toBeInTheDocument();
    expect(screen.getByText('This is a test post body')).toBeInTheDocument();
  });

  it('calls onClick when card is clicked', async () => {
    const handleClick = jest.fn();
    const { user } = render(
      <PostCard post={mockPost} onClick={handleClick} />,
      { wrapper: createWrapper() }
    );

    await user.click(screen.getByRole('article'));

    expect(handleClick).toHaveBeenCalledWith(1);
  });
});
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-30 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
claude-sonnet-4-5-20250929

### Debug Log References
None

### Completion Notes
- All functional requirements implemented
- API services, hooks, components, and page created per specifications
- Client-side pagination implemented (10 posts/page)
- Loading skeletons, empty states, and error boundary implemented
- Lint passes with no errors
- Test infrastructure set up (Jest + React Testing Library + Playwright)
- All tests written and passing:
  - Unit tests: PostCard, PostList, Pagination, usePosts hook (35 tests total)
  - Integration test: Full post feed flow with pagination
  - E2E tests: Pagination navigation, URL persistence, browser nav
- Story complete and ready for QA

### File List
**Created:**
- app/page.tsx (modified - posts feed page)
- app/error.tsx
- components/posts/post-card.tsx
- components/posts/post-list.tsx
- components/shared/user-avatar.tsx
- components/shared/loading-skeleton.tsx
- components/shared/empty-state.tsx
- components/shared/pagination.tsx
- jest.config.ts
- jest.setup.ts
- playwright.config.ts
- tests/unit/components/posts/post-card.test.tsx
- tests/unit/components/posts/post-list.test.tsx
- tests/unit/components/shared/pagination.test.tsx
- tests/unit/hooks/use-posts.test.tsx
- tests/integration/post-viewing.test.tsx
- tests/e2e/posts/view-posts-feed.spec.ts

**Existing (leveraged):**
- lib/api/client.ts
- lib/api/schemas.ts
- lib/api/posts.ts
- lib/api/users.ts
- lib/hooks/use-posts.ts
- lib/hooks/use-users.ts
- lib/query-keys.ts
- types/index.ts

## QA Results
_To be filled by QA Agent_