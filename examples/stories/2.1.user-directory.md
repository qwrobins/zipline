# Story 2.1: User Directory Page

## Status
Approved

## Story
**As a** user,
**I want** to see a list of all users in the system,
**so that** I can discover authors and navigate to their profiles.

## Acceptance Criteria
1. User directory page created at `/users` route
2. All users displayed in a responsive grid (3-4 columns on desktop, 1-2 on mobile)
3. Each user card shows: avatar (generated from initials), name, username, email, and company name
4. User cards are clickable and navigate to individual profile page (`/users/[id]`)
5. Loading skeletons displayed while users are being fetched
6. Empty state displayed if no users found (unlikely with JSONPlaceholder)
7. Error boundary handles API failures with retry option
8. User avatars have consistent color-coding based on user ID or name hash

## Tasks / Subtasks
- [ ] Create user directory page route (AC: 1)
  - [ ] Create `/app/users/page.tsx` with client component directive
  - [ ] Set up page metadata for SEO
  - [ ] Add breadcrumb navigation
- [ ] Implement API service for users (AC: 1)
  - [ ] Create `lib/api/users.ts` with `fetchUsers()` function
  - [ ] Add Zod schema validation in `lib/api/schemas.ts` for User type
  - [ ] Test API fetch with proper error handling
- [ ] Create React Query hook for users (AC: 1, 5, 7)
  - [ ] Create `lib/hooks/use-users.ts` with `useUsers()` query hook
  - [ ] Configure proper query key structure
  - [ ] Add staleTime and cacheTime configuration
  - [ ] Implement retry and error handling logic
- [ ] Create UserCard component (AC: 3, 4, 8)
  - [ ] Create `components/users/user-card.tsx` with Card wrapper
  - [ ] Display user avatar, name, username, email, company name
  - [ ] Add hover and click interactions
  - [ ] Implement navigation to user profile on click
- [ ] Create UserAvatar component (AC: 3, 8)
  - [ ] Create `components/users/user-avatar.tsx` using shadcn Avatar
  - [ ] Generate initials from user name
  - [ ] Implement consistent color-coding based on user ID or name hash
  - [ ] Support multiple size variants (sm, md, lg)
- [ ] Implement responsive grid layout (AC: 2)
  - [ ] Use Tailwind CSS grid with responsive breakpoints
  - [ ] Configure 3-4 columns on desktop (lg:grid-cols-3 xl:grid-cols-4)
  - [ ] Configure 1-2 columns on mobile (grid-cols-1 sm:grid-cols-2)
  - [ ] Add appropriate gap spacing
- [ ] Create loading state (AC: 5)
  - [ ] Create `/app/users/loading.tsx` with skeleton components
  - [ ] Use shadcn Skeleton component
  - [ ] Match grid layout of actual content
  - [ ] Display 8-12 skeleton cards
- [ ] Create empty state (AC: 6)
  - [ ] Add conditional rendering for empty user array
  - [ ] Create empty state component with icon and message
  - [ ] Suggest action to reload or check connection
- [ ] Implement error handling (AC: 7)
  - [ ] Create `/app/users/error.tsx` error boundary
  - [ ] Display user-friendly error message
  - [ ] Add retry button to refetch users
  - [ ] Log errors to console for debugging

## Dev Notes

### Route Structure
[Source: docs/architecture/unified-project-structure.md]

Create the following files:
```
app/
├── users/
│   ├── page.tsx           # User directory page
│   ├── loading.tsx        # Loading skeleton
│   └── error.tsx          # Error boundary
```

### Data Model
[Source: docs/architecture/data-models.md]

User interface to use:
```typescript
interface User {
  id: number;
  name: string;
  username: string;
  email: string;
  address: {
    street: string;
    suite: string;
    city: string;
    zipcode: string;
    geo: {
      lat: string;
      lng: string;
    };
  };
  phone: string;
  website: string;
  company: {
    name: string;
    catchPhrase: string;
    bs: string;
  };
}
```

### API Service Implementation
[Source: docs/architecture/components.md, docs/architecture/frontend-architecture.md]

Create `lib/api/users.ts`:
```typescript
import { apiFetch } from './client';
import { userArraySchema } from './schemas';
import type { User } from '@/types';

export async function fetchUsers(): Promise<User[]> {
  return apiFetch('/users', undefined, userArraySchema);
}
```

Add to `lib/api/schemas.ts`:
```typescript
import { z } from 'zod';

export const userSchema = z.object({
  id: z.number(),
  name: z.string(),
  username: z.string(),
  email: z.string().email(),
  address: z.object({
    street: z.string(),
    suite: z.string(),
    city: z.string(),
    zipcode: z.string(),
    geo: z.object({
      lat: z.string(),
      lng: z.string(),
    }),
  }),
  phone: z.string(),
  website: z.string(),
  company: z.object({
    name: z.string(),
    catchPhrase: z.string(),
    bs: z.string(),
  }),
});

export const userArraySchema = z.array(userSchema);
```

### React Query Hook
[Source: docs/architecture/components.md, docs/architecture/frontend-architecture.md]

Create `lib/hooks/use-users.ts`:
```typescript
import { useQuery } from '@tanstack/react-query';
import { fetchUsers } from '@/lib/api/users';
import { queryKeys } from '@/lib/query-keys';

export function useUsers() {
  return useQuery({
    queryKey: queryKeys.users.list(),
    queryFn: fetchUsers,
    staleTime: 5 * 60 * 1000, // 5 minutes
    cacheTime: 10 * 60 * 1000, // 10 minutes
  });
}
```

Add to `lib/query-keys.ts`:
```typescript
export const queryKeys = {
  users: {
    all: ['users'] as const,
    lists: () => [...queryKeys.users.all, 'list'] as const,
    list: () => [...queryKeys.users.lists()] as const,
    details: () => [...queryKeys.users.all, 'detail'] as const,
    detail: (id: number) => [...queryKeys.users.details(), id] as const,
  },
} as const;
```

### Component Structure
[Source: docs/architecture/components.md]

Components to create:
- `components/users/user-card.tsx` - User summary card
- `components/users/user-avatar.tsx` - Avatar with initials and color
- `components/users/user-directory.tsx` - Main directory grid container

### UserAvatar Implementation
For consistent color-coding based on user ID or name, use a hash function:
```typescript
function getAvatarColor(userId: number): string {
  const colors = [
    'bg-red-500',
    'bg-blue-500',
    'bg-green-500',
    'bg-yellow-500',
    'bg-purple-500',
    'bg-pink-500',
    'bg-indigo-500',
    'bg-teal-500',
  ];
  return colors[userId % colors.length];
}

function getInitials(name: string): string {
  return name
    .split(' ')
    .map(word => word[0])
    .join('')
    .toUpperCase()
    .slice(0, 2);
}
```

### shadcn/ui Components Needed
[Source: docs/architecture/tech-stack.md]

Install these shadcn/ui components:
- Card (for user cards)
- Avatar (for user avatars)
- Skeleton (for loading states)
- Button (for retry in error state)

Commands:
```bash
pnpm dlx shadcn@latest add card
pnpm dlx shadcn@latest add avatar
pnpm dlx shadcn@latest add skeleton
pnpm dlx shadcn@latest add button
```

### Responsive Grid Configuration
[Source: docs/architecture/coding-standards.md]

Use Tailwind CSS classes:
```typescript
<div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
  {users.map(user => <UserCard key={user.id} user={user} />)}
</div>
```

### Navigation Implementation
Use Next.js Link component for client-side navigation:
```typescript
import Link from 'next/link';

<Link href={`/users/${user.id}`}>
  <UserCard user={user} />
</Link>
```

### Coding Standards
[Source: docs/architecture/coding-standards.md]

- File naming: kebab-case (e.g., `user-card.tsx`, `user-avatar.tsx`)
- Component naming: PascalCase (e.g., `UserCard`, `UserAvatar`)
- Props interfaces: PascalCase with 'Props' suffix (e.g., `UserCardProps`)
- Use TypeScript strict mode - no `any` types
- All API responses must be validated with Zod schemas
- Always show skeletons during data fetching
- Implement proper error boundaries with retry options

### Accessibility Requirements
[Source: docs/architecture/coding-standards.md, docs/architecture/tech-stack.md]

- All user cards must be keyboard navigable
- Add proper ARIA labels to avatars
- Ensure color contrast meets WCAG AA standards
- Add focus states to clickable cards
- Use semantic HTML (article tags for cards)

### Testing
[Source: docs/architecture/testing-strategy.md]

Unit tests to create:
- `tests/unit/components/users/user-card.test.tsx` - Test rendering, click handling
- `tests/unit/components/users/user-avatar.test.tsx` - Test initials, color generation
- `tests/unit/hooks/use-users.test.ts` - Test query hook

E2E tests to create:
- `tests/e2e/users/view-user-directory.spec.ts` - Test navigation to directory, grid display, card clicks

Test requirements:
- Verify all users are displayed in grid
- Test responsive layout at different breakpoints
- Verify loading skeletons appear while fetching
- Test error boundary with retry functionality
- Verify navigation to user profile on card click
- Test avatar color consistency

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-30 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

## QA Results
_To be filled by QA Agent_