# Story 4.3: Filter Todos by Status

## Status
Approved

## Story
**As a** user,
**I want** to filter todos by completion status,
**so that** I can focus on open tasks or review completed work.

## Acceptance Criteria
1. Filter controls displayed above todos list (radio buttons or select dropdown)
2. Filter options: All, Open (incomplete), Completed
3. Selecting filter immediately updates displayed todos list
4. Filter state reflected in URL query parameter (`?status=completed`)
5. Filter persists across page refreshes and browser navigation
6. Empty state message displayed if no todos match filter (e.g., "No open todos!")
7. Todo count summary respects current filter (e.g., "Showing 8 of 20 todos")
8. Filter applies to both user profile Todos tab and global todos view

## Tasks / Subtasks
- [ ] Create TodoFilters component with filter controls (AC: 1, 2)
  - [ ] Import shadcn/ui RadioGroup or Select component
  - [ ] Create filter UI with three options: All, Open, Completed
  - [ ] Style filter controls to match design system
  - [ ] Add accessibility labels for screen readers
- [ ] Implement URL query parameter state management (AC: 4, 5)
  - [ ] Use Next.js useSearchParams hook to read status param
  - [ ] Use useRouter to update URL when filter changes
  - [ ] Parse status param on component mount (default to "all")
  - [ ] Update URL without page reload when filter selected
- [ ] Filter todos list based on status parameter (AC: 3)
  - [ ] Pass status filter to useTodos hook
  - [ ] Filter todos in query or client-side based on completed field
  - [ ] Update todos list immediately when filter changes
- [ ] Create empty state component for no results (AC: 6)
  - [ ] Show message when filtered list is empty
  - [ ] Customize message based on filter ("No open todos!" vs "No completed todos!")
  - [ ] Include helpful action (e.g., "Create a todo" button)
- [ ] Update todo count summary to respect filter (AC: 7)
  - [ ] Calculate filtered count vs total count
  - [ ] Display "Showing X of Y todos" when filter applied
  - [ ] Display "X/Y completed" when showing all todos
- [ ] Apply filter to user profile Todos tab (AC: 8)
  - [ ] Integrate TodoFilters into user profile Todos tab
  - [ ] Verify URL params work in profile context (/users/[id]?status=open)
  - [ ] Ensure filter state persists across navigation
- [ ] Apply filter to global todos view (AC: 8)
  - [ ] Integrate TodoFilters into global todos page (/todos)
  - [ ] Verify URL params work in global context (/todos?status=completed)
  - [ ] Ensure same filter logic applies to both views

## Dev Notes

### Todo Data Model
[Source: docs/architecture/data-models.md]

The Todo interface for filtering:

```typescript
interface Todo {
  id: number;
  userId: number;
  title: string;
  completed: boolean;  // Filter target field
}
```

**Filter Types:**
```typescript
type TodoStatus = 'all' | 'open' | 'completed';

interface TodoFilters {
  userId?: number;
  status?: TodoStatus;
}
```

### URL State Management with Next.js
[Source: docs/architecture/frontend-architecture.md]

**Route Patterns:**
- **URL State Management:** Search params for filters (`?page=2&q=foo&userId=3`)

**Next.js App Router Hooks:**
```typescript
'use client';

import { useSearchParams, useRouter } from 'next/navigation';

const searchParams = useSearchParams();
const router = useRouter();

// Read status from URL
const status = searchParams.get('status') || 'all';

// Update URL when filter changes
const handleFilterChange = (newStatus: TodoStatus) => {
  const params = new URLSearchParams(searchParams);
  if (newStatus === 'all') {
    params.delete('status');
  } else {
    params.set('status', newStatus);
  }
  router.push(`?${params.toString()}`);
};
```

**URL Persistence:**
- Filter state persists in URL across page refreshes
- Browser back/forward buttons work with filter state
- Shareable URLs include filter state

### React Query with Filters
[Source: docs/architecture/components.md]

**Query Hook with Filters:**
```typescript
useTodos(userId?, status?): Query hook for todos with filters
```

[Source: docs/architecture/frontend-architecture.md]

**Query Keys with Filters:**
```typescript
export const queryKeys = {
  todos: {
    all: ['todos'] as const,
    lists: () => [...queryKeys.todos.all, 'list'] as const,
    list: (filters: TodoFilters) => [...queryKeys.todos.lists(), filters] as const,
  },
} as const;
```

**Implementation:**
- Include status filter in query key for proper caching
- Each filter combination gets its own cache entry
- Switching filters triggers new query (if not cached)

### Client-Side Filtering vs API Filtering
[Source: docs/architecture/components.md]

JSONPlaceholder API does not support filtering by completed status, so filtering must be done client-side:

**Client-Side Filter Logic:**
```typescript
const { data: allTodos } = useTodos(userId);

const filteredTodos = useMemo(() => {
  if (!allTodos) return [];

  switch (status) {
    case 'open':
      return allTodos.filter(todo => !todo.completed);
    case 'completed':
      return allTodos.filter(todo => todo.completed);
    case 'all':
    default:
      return allTodos;
  }
}, [allTodos, status]);
```

Alternatively, implement filtering inside the useTodos hook to encapsulate logic.

### Component Architecture
[Source: docs/architecture/frontend-architecture.md]

**Component Location:**
```
components/todos/
├── todo-filters.tsx    # Filter controls (CREATE THIS)
├── todo-list.tsx       # List of todos (UPDATE THIS)
├── todo-item.tsx       # Individual todo item
└── todo-form.tsx       # Form for creating todos
```

**shadcn/ui Components to Use:**
- RadioGroup for filter options (recommended for accessibility)
- Alternative: Select dropdown for mobile-friendly UI
- Badge to show active filter
- Optional: Tabs component for filter UI

### Empty State Component
[Source: docs/architecture/frontend-architecture.md]

**Shared Component:**
```
components/shared/
└── loading-skeleton.tsx    # Existing
└── empty-state.tsx         # CREATE THIS (or inline)
```

**Empty State Pattern:**
```typescript
interface EmptyStateProps {
  message: string;
  action?: {
    label: string;
    onClick: () => void;
  };
}

const EmptyState: FC<EmptyStateProps> = ({ message, action }) => (
  <div className="text-center py-8">
    <p className="text-muted-foreground mb-4">{message}</p>
    {action && (
      <Button onClick={action.onClick}>{action.label}</Button>
    )}
  </div>
);
```

**Usage in TodoList:**
```typescript
if (filteredTodos.length === 0) {
  const message = status === 'open'
    ? 'No open todos!'
    : status === 'completed'
    ? 'No completed todos!'
    : 'No todos found!';

  return <EmptyState message={message} />;
}
```

### Todo Count Summary Logic
[Source: AC 7]

Todo count must respect current filter:

**Display Logic:**
```typescript
const totalCount = allTodos?.length || 0;
const filteredCount = filteredTodos.length;
const completedCount = allTodos?.filter(t => t.completed).length || 0;

// When filter applied
if (status !== 'all') {
  return `Showing ${filteredCount} of ${totalCount} todos`;
}

// When showing all
return `${completedCount}/${totalCount} completed`;
```

### Filter UI Patterns
[Source: docs/architecture/tech-stack.md, docs/architecture/coding-standards.md]

**Accessibility Requirements:**
- **Accessibility:** All interactive elements must have proper ARIA labels and keyboard navigation
- **UI Primitives:** Radix UI for headless accessible components

**RadioGroup Pattern (Recommended):**
```typescript
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';

<RadioGroup value={status} onValueChange={handleFilterChange}>
  <div className="flex items-center space-x-2">
    <RadioGroupItem value="all" id="all" />
    <label htmlFor="all">All</label>
  </div>
  <div className="flex items-center space-x-2">
    <RadioGroupItem value="open" id="open" />
    <label htmlFor="open">Open</label>
  </div>
  <div className="flex items-center space-x-2">
    <RadioGroupItem value="completed" id="completed" />
    <label htmlFor="completed">Completed</label>
  </div>
</RadioGroup>
```

**Alternative: Select Dropdown:**
```typescript
import { Select, SelectContent, SelectItem, SelectTrigger } from '@/components/ui/select';

<Select value={status} onValueChange={handleFilterChange}>
  <SelectTrigger>
    <SelectValue />
  </SelectTrigger>
  <SelectContent>
    <SelectItem value="all">All Todos</SelectItem>
    <SelectItem value="open">Open</SelectItem>
    <SelectItem value="completed">Completed</SelectItem>
  </SelectContent>
</Select>
```

### Applying Filter to Multiple Views
[Source: AC 8]

The same TodoFilters and TodoList components must work in:

1. **User Profile Todos Tab:** `/users/[id]?status=open`
   - Filter scoped to specific user (pass userId to useTodos)
   - URL params include both user ID and status filter

2. **Global Todos Page:** `/todos?status=completed`
   - Filter applies to all todos (no userId passed to useTodos)
   - URL params include only status filter

**Component Reusability:**
```typescript
// In user profile
<TodoFilters />
<TodoList userId={userId} />

// In global todos
<TodoFilters />
<TodoList />
```

Both views share the same components; filtering logic adapts based on presence of userId prop.

### Testing
[Source: docs/architecture/testing-strategy.md]

**Unit Tests Required:**
- `tests/unit/components/todos/todo-filters.test.tsx`
  - Renders filter options (All, Open, Completed)
  - Calls filter handler when option selected
  - Shows active filter state
  - Has proper ARIA labels

**Integration Tests Required:**
- `tests/integration/todo-management.test.tsx`
  - Filters todos list by status
  - Updates URL query parameter when filter changes
  - Reads filter from URL on mount
  - Shows empty state when no todos match filter
  - Updates todo count based on filter

**E2E Tests Required:**
- `tests/e2e/todos/filter-todos.spec.ts`
  - User can select filter options
  - Todos list updates immediately
  - URL includes status query parameter
  - Filter persists on page refresh
  - Empty state shown for no results
  - Todo count respects filter
  - Filter works on user profile Todos tab
  - Filter works on global todos page

**E2E Test Pattern:**
```typescript
import { test, expect } from '@playwright/test';

test('filters todos by completion status', async ({ page }) => {
  await page.goto('/users/1');

  // Wait for todos to load
  await expect(page.locator('[data-testid="todo-list"]')).toBeVisible();

  // Select "Open" filter
  await page.click('text=Open');

  // Verify URL updated
  expect(page.url()).toContain('status=open');

  // Verify only incomplete todos shown
  const todos = page.locator('[data-testid="todo-item"]');
  const count = await todos.count();

  for (let i = 0; i < count; i++) {
    const checkbox = todos.nth(i).locator('input[type="checkbox"]');
    await expect(checkbox).not.toBeChecked();
  }

  // Verify count summary
  await expect(page.locator('text=/Showing \\d+ of \\d+ todos/')).toBeVisible();
});
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-30 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be filled by Dev Agent_

### Debug Log References
_To be filled by Dev Agent_

### Completion Notes
_To be filled by Dev Agent_

### File List
_To be filled by Dev Agent_

## QA Results
_To be filled by QA Agent_